{% extends "base.html" %}

{% block content %}

<style>
  .icons {
    width: auto;
    padding: 10px 10px 10px 10px;
  }

  .icons i {
    font-size: 20px;
    cursor: pointer;
    margin: 5px 5px 5px 5px
  }

  .icons a {
    color: black;
  }

  .actions a {
    color: black !important;
  }

  .actions a .fa-solid {
    font-size: 20px !important;
    margin-right: 10px;
  }
</style>


<div class="container">

  {% if delete %}
  <br><br>

  <div class="alert alert-danger" role="alert">
    <p>Do you want to delete the article <strong>{{ blog.title }}</strong>?</p>
    <form action="" method="POST">
      {% csrf_token %}
      <span>
        <a href="{% url 'profile' %}" class="btn btn-secondary">Cancel</a>
        <a href=""><button class="btn btn-danger">Delete</button></a>
      </span>
    </form>
  </div>
  {% endif %}

  <div class="main-body">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="main-breadcrumb">
      <ol class="breadcrumb">

      </ol>
    </nav>
    <!-- /Breadcrumb -->

    <div class="row gutters-sm">
      <div class="col-md-4 mb-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-column align-items-center text-center">

              {% if user_profile.profile_pic %}
              <img src="{{ user_profile.profile_pic.url }}" alt="Profile Picture" class="rounded-circle" width="150">
              {% else %}
              <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Default Profile" class="rounded-circle" width="150">
              {% endif %}

              <div class="mt-3">
                <h4>{{ user_profile.first_name }} {{ user_profile.last_name }}</h4>
                <p class="text-secondary mb-1">{{ user_profile.role }}</p>
                <p class="text-muted font-size-sm">{{ user_profile.address }}</p>

                {% if request.user == user_profile %}
                <!-- Si el usuario está viendo su propio perfil -->
                <p>Seguidores: {{ profile.follower_count }}</p>
                <p>Siguiendo: {{ profile.following_count }}</p>
                {% else %}
                <!-- Si el usuario está viendo el perfil de otro usuario -->
                {% if is_following %}
                <form action="{% url 'unfollow' user_profile.username %}" method="post">
                  {% csrf_token %}
                  <button type="submit">Unfollow</button>
                </form>
                {% else %}
                <form action="{% url 'follow' user_profile.username %}" method="post">
                  {% csrf_token %}
                  <button type="submit">Follow</button>
                </form>
                {% endif %}
                {% endif %}

                <h2>Seguidores: {{ user_profile.followers.count }}</h2>
                <h2>Siguiendo: {{ user_profile.following.count }}</h2>

                {% if request.user == user_profile %}
                <div class="row">
                  <div class="col-sm-12">
                    <a class="btn btn-info" target="__blank" href="{% url 'update-profile' %}">Edit</a>
                  </div>
                </div>
                {% endif %}

              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card mb-3">
          <div class="card-body">
            <div class="row">
              <div class="col-sm-3">
                <h6 class="mb-0">Bio</h6>
              </div>
              <div class="col-sm-9 text-secondary">
                {{ user_profile.bio }}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h6 class="mb-0">Email</h6>
              </div>
              <div class="col-sm-9 text-secondary">
                {{ user_profile.email }}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h6 class="mb-0">Phone</h6>
              </div>
              <div class="col-sm-9 text-secondary">
                {{ user_profile.phone }}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h6 class="mb-0">Username</h6>
              </div>
              <div class="col-sm-9 text-secondary">
                {{ user_profile.username }}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h6 class="mb-0">Address</h6>
              </div>
              <div class="col-sm-9 text-secondary">
                {{ user_profile.address }}
              </div>
            </div>
          </div>
        </div>

        <div class="container blog-container" style="border: 1px solid silver">
          <h5>Articles by {{ user_profile.username }}</h5>
          <div class="row">
            {% for blog in blogs %}
            <div class="col-md-6">
              <div class="card mb-4">
                <a href="#!"><img class="card-img-top" src="{{ blog.thumbnail.url }}" alt="..." /></a>
                <div class="card-body">
                  <div class="small text-muted">{{ blog.created }}</div>
                  <h2 class="card-title h4">{{ blog.title }}</h2>
                  <p class="card-text">{{ blog.body | safe | truncatechars:"100" }}</p>
                  <a class="btn btn-primary" href="{% url 'detail' slug=blog.slug %}">Read more →</a>
                  {% if request.user == user_profile %}
                  <span style="float: right" class="actions">
                    <a href="{% url 'update-article' slug=blog.slug %}"><i class="fa-solid fa-pen-to-square"></i></a>
                    <a href="{% url 'delete-article' blog.slug %}"><i class="fa-solid fa-trash-can"></i></a>
                  </span>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %}
